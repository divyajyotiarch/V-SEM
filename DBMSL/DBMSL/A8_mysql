TRIGGER IN MYSQL

MySQL [t3177db]> select * from student;
+--------+-------+------------+------+--------+
| rollno | name  | doa        | per  | branch |
+--------+-------+------------+------+--------+
|   3178 | divya | 1998-04-05 |   88 | NULL   |
|   3177 | medha | 1998-08-05 |   98 | NULL   |
|   3179 | tej   | 1998-08-07 |   93 | NULL   |
|   3135 | neel  | 1996-09-05 |   77 | NULL   |
|   3165 | nitin | 1996-10-05 |   57 | NULL   |
|   NULL | NULL  | NULL       | NULL | CE     |
|   NULL | NULL  | NULL       | NULL | CE     |
|   NULL | NULL  | NULL       | NULL | IT     |
|   NULL | NULL  | NULL       | NULL | E&TC   |
|   NULL | NULL  | NULL       | NULL | IT     |
+--------+-------+------------+------+--------+
10 rows in set (0.00 sec)

MySQL [t3177db]> create table alumni(srno int not null auto_incrementMySQL [t3177db]> INSERT INTO student values (3122,'pooja','2015-06-01',77,'E&TC');
    -> //
Query OK, 1 row affected (0.03 sec)



MySQL [t3177db]> create table alumni_after(srno int not null auto_increment,primary key(srno),stat varchar(100));
Query OK, 0 rows affected (0.12 sec)

MySQL [t3177db]> rename table alumni to alumni_before;
Query OK, 0 rows affected (0.15 sec)

MySQL [t3177db]> alter table alumni_after change stat user varchar(50);
    -> //
Query OK, 2 rows affected (0.22 sec)
Records: 2  Duplicates: 0  Warnings: 0

MySQL [t3177db]> alter table alumni_after add id int; //
Query OK, 2 rows affected (0.35 sec)
Records: 2  Duplicates: 0  Warnings: 0

MySQL [t3177db]> alter table alumni_after add on_date date; //
Query OK, 2 rows affected (0.23 sec)
Records: 2  Duplicates: 0  Warnings: 0

MySQL [t3177db]> alter table alumni_after modify operation varchar(20) NOT NULL;
Query OK, 2 rows affected, 2 warnings (0.24 sec)
Records: 2  Duplicates: 0  Warnings: 2

MySQL [t3177db]> alter table alumni_after modify id int NOT NULL;
Query OK, 2 rows affected, 2 warnings (0.23 sec)
Records: 2  Duplicates: 0  Warnings: 2

MySQL [t3177db]> alter table alumni_after modify on_date date NOT NULL;
Query OK, 2 rows affected, 2 warnings (0.23 sec)
Records: 2  Duplicates: 0  Warnings: 2

MySQL [t3177db]> DELIMITER //
MySQL [t3177db]> CREATE TRIGGER af_delete
    -> AFTER DELETE
    -> ON student FOR EACH ROW
    -> BEGIN
    -> DECLARE sys_user varchar(20);
    -> SELECT USER() INTO sys_user;
    -> INSERT INTO alumni_after (srno,user,operation,id,on_date) VALUES (NULL,sys_user,'deleted',OLD.rollno,SYSDATE());
    -> end; 
    -> // delimiter ;
Query OK, 0 rows affected (0.11 sec)

MySQL [t3177db]> delete from student where name = 'tej';
Query OK, 1 row affected (0.03 sec)

MySQL [t3177db]> select * from alumni_after;
+------+-------------------+-----------+------+------------+
| srno | user              | operation | id   | on_date    |
+------+-------------------+-----------+------+------------+
|    1 | t3177@10.10.15.77 |           |    0 | 0000-00-00 |
|    2 | t3177@10.10.15.77 |           |    0 | 0000-00-00 |
|    3 | t3177@10.10.15.77 | deleted   | 3179 | 2018-07-19 |
+------+-------------------+-----------+------+------------+
3 rows in set (0.00 sec)

MySQL [t3177db]> INSERT INTO student values (3122,'pooja','2015-06-01',77,'E&TC');
    -> //
Query OK, 1 row affected (0.03 sec)

MySQL [t3177db]> select * from alumni_after;
    -> //
+------+-------------------+-----------+------+------------+
| srno | user              | operation | id   | on_date    |
+------+-------------------+-----------+------+------------+
|    1 | t3177@10.10.15.77 |           |    0 | 0000-00-00 |
|    2 | t3177@10.10.15.77 |           |    0 | 0000-00-00 |
|    3 | t3177@10.10.15.77 | deleted   | 3179 | 2018-07-19 |
|    4 | t3177@10.10.15.77 | inserted  | 3122 | 2018-07-19 |
+------+-------------------+-----------+------+------------+
4 rows in set (0.00 sec)

MySQL [t3177db]> CREATE TRIGGER af_update AFTER UPDATE ON student FOR EACH ROW BEGIN DECLARE sys_user2 varchar(20); SELECT USER() INTO sys_user2; INSERT INTO alumni_after (srno,user,operation,id,on_date) VALUES (NULL,sys_user2,'updated',OLD.rollno,SYSDATE()); END;//
Query OK, 0 rows affected (0.06 sec)

MySQL [t3177db]> UPDATE student SET branch='CE' where name='divya'; //Query OK, 1 row affected (0.03 sec)
Rows matched: 1  Changed: 1  Warnings: 0

MySQL [t3177db]> select * from alumni_after; //
+------+-------------------+-----------+------+------------+
| srno | user              | operation | id   | on_date    |
+------+-------------------+-----------+------+------------+
|    1 | t3177@10.10.15.77 |           |    0 | 0000-00-00 |
|    2 | t3177@10.10.15.77 |           |    0 | 0000-00-00 |
|    3 | t3177@10.10.15.77 | deleted   | 3179 | 2018-07-19 |
|    4 | t3177@10.10.15.77 | inserted  | 3122 | 2018-07-19 |
|    5 | t3177@10.10.15.77 | updated   | 3178 | 2018-07-19 |
+------+-------------------+-----------+------+------------+
5 rows in set (0.00 sec)

MySQL [t3177db]> CREATE TRIGGER bef_update before UPDATE ON student FOR EACH ROW BEGIN DECLARE sys_user2 varchar(20); SELECT USER() INTO sys_user2; INSERT INTO alumni_before (srno,user,operation,id,on_date) VALUES (NULL,sys_user2,'updated',OLD.rollno,SYSDATE()); END;//
Query OK, 0 rows affected (0.08 sec)

MySQL [t3177db]> CREATE TRIGGER bef_insert before INSERT ON student FOR EACH ROW BEGIN DECLARE sys_user2 varchar(20); SELECT USER() INTO sys_user2; INSERT INTO alumni_before (srno,user,operation,id,on_date) VALUES (NULL,sys_user2,'inserted',NEW.rollno,SYSDATE()); END;//
Query OK, 0 rows affected (0.07 sec)

MySQL [t3177db]> CREATE TRIGGER bef_delete before DELETE ON student FOR EACH ROW BEGIN DECLARE sys_user2 varchar(20); SELECT USER() INTO sys_user2; INSERT INTO alumni_before (srno,user,operation,id,on_date) VALUES (NULL,sys_user2,'deleted',OLD.rollno,SYSDATE()); END;//
Query OK, 0 rows affected (0.09 sec)

MySQL [t3177db]> delete from student where rollno=NULL; //
Query OK, 0 rows affected (0.01 sec)

MySQL [t3177db]> delete from student where branch='E&TC'; //
ERROR 1048 (23000): Column 'id' cannot be null
MySQL [t3177db]> select * from alumni_before; //
+------+-------------------+-----------+------+------------+
| srno | user              | operation | id   | on_date    |
+------+-------------------+-----------+------+------------+
|    1 | t3177@10.10.15.77 | updated   | 3165 | 2018-07-19 |
+------+-------------------+-----------+------+------------+
1 row in set (0.00 sec)

MySQL [t3177db]> INSERT INTO student values (3143,'hema','2015-06-06',77,'E&TC');
    -> //
Query OK, 1 row affected (0.06 sec)

MySQL [t3177db]> select * from alumni_before; //
+------+-------------------+-----------+------+------------+
| srno | user              | operation | id   | on_date    |
+------+-------------------+-----------+------+------------+
|    1 | t3177@10.10.15.77 | updated   | 3165 | 2018-07-19 |
|    3 | t3177@10.10.15.77 | inserted  | 3143 | 2018-07-19 |
+------+-------------------+-----------+------+------------+
2 rows in set (0.00 sec)

MySQL [t3177db]> delete from student where branch='E&TC'; //
ERROR 1048 (23000): Column 'id' cannot be null
MySQL [t3177db]> delete from student where rollno=3165; //
Query OK, 1 row affected (0.04 sec)

MySQL [t3177db]> select * from alumni_before; //
+------+-------------------+-----------+------+------------+
| srno | user              | operation | id   | on_date    |
+------+-------------------+-----------+------+------------+
|    1 | t3177@10.10.15.77 | updated   | 3165 | 2018-07-19 |
|    3 | t3177@10.10.15.77 | inserted  | 3143 | 2018-07-19 |
|    4 | t3177@10.10.15.77 | deleted   | 3165 | 2018-07-19 |
+------+-------------------+-----------+------+------------+
3 rows in set (0.00 sec)





